<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

.topnav {
  overflow: hidden;
  background-color: #333;
}

.topnav a {
  float: left;
  color: #f2f2f2;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #04AA6D;
  color: white;
}

.hidden {
  display: none;
}
</style>
</head>
<body>

<div class="topnav">
  <a id="nav_home" class=" active" href="#home">Home</a>
  <a href="{{ loginUrl }}">Login</a>
  <a id="nav_make" class="menu" href="#make">Make</a>
  <a id="nav_logout" class="" href="#logout" logout-url = "{{ logoutUrl }}">Logout</a>
</div>

<div style="padding-left:16px">
  <h2>Vehicle Information</h2>
  <div id="homepage">
    <h3>Welcome to homepage</h3>
  </div>
  <div class="hidden" id="loginpage"></div>
  <div class="" id="makepage">
    <ul id="makes"/>
  </div>
  
  <div class = "hidden" id = "error" > Something went wrong! </div>

</div>

<script>
  window.addEventListener("DOMContentLoaded", (event) => {
    var fragment = window.location.hash.substr(1).split('&')[0].split('=');
    var loginpage = document.getElementById("loginpage");
    var homepage = document.getElementById("homepage");
    var makepage = document.getElementById("makepage");

    if ( fragment[0] === 'access_token' ) {
      loginpage.innerHTML = fragment[1]; 
      loginpage.className = ''
      localStorage.setItem('JWTS_LOCAL_KEY', fragment[1]) // add the access token to the jwt

    }

    const nav_make = document.getElementById('nav_make');
    nav_make.onclick = function(e) {
      setTimeout(() => {
        nav_make.className = 'active';
        loginpage.className = 'hidden';
        homepage.classname = 'hidden';
      }, 10);

      jwt = localStorage.getItem('JWTS_LOCAL_KEY');

      fetch('/makes', {
        method: 'GET',
        headers: {
          'Content-type': 'application/json',
          'Authorization': `Bearer ${jwt}`, // notice the Bearer before your token
        },
      })
      .then(resp => resp.json())
      .then(function(json) {
        //console.log(JSON.stringify(json))
        makes = document.getElementById('makes');
        makes.innerHTML = ''
        
        for(let c=0; c<json['makes'].length; c++){
          const liItem= document.createElement('LI');
          liItem.innerHTML = json['makes'][c]['name'];
          makes.appendChild(liItem);
        }
        document.getElementById('error').classname='hidden';
          //window.location.reload(true);
      })
      .catch(function(ex) {
        error =  document.getElementById('error').className='';
      })
    }
    
    const nav_logout = document.getElementById('nav_logout');
    nav_logout.onclick = function(e) {
      nav_logout.classname='active';
      localStorage.setItem('JWTS_LOCAL_KEY', '');
      logout_url = nav_logout.getAttribute('logout-url');
      window.location.href = logout_url
    }

    const nav_home = document.getElementById('nav_home');
    nav_home.onclick = function(e) {
      setTimeout(() => {
        loginpage.className='hidden';
        makepage.className='hidden';
        homepage.classname='';
        nav_home.classname='active';
      }, 10);
    }
    
  });
  
</script>

</body>
</html>
